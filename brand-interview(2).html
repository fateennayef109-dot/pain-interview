<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Brand Discovery Interview — Pain Research Centre</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display:ital@0;1&family=DM+Sans:wght@300;400;500&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
<script>emailjs.init("pEMnp9BpxBuJh8oqK");</script>
<style>
  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

  :root {
    --bg: #0d0f14;
    --surface: #161920;
    --border: #252832;
    --accent: #c8a96e;
    --accent-dim: rgba(200, 169, 110, 0.12);
    --text: #e8e4dc;
    --muted: #6b7080;
    --user-bg: #1e2330;
    --ai-bg: #161920;
  }

  html, body {
    height: 100%;
    background: var(--bg);
    color: var(--text);
    font-family: 'DM Sans', sans-serif;
    font-weight: 300;
    line-height: 1.6;
    overflow: hidden;
  }

  .shell {
    display: grid;
    grid-template-rows: auto 1fr auto;
    height: 100vh;
    max-width: 780px;
    margin: 0 auto;
  }

  header {
    padding: 24px 32px 18px;
    border-bottom: 1px solid var(--border);
    display: flex;
    align-items: center;
    gap: 16px;
  }

  .header-icon {
    width: 38px; height: 38px;
    border-radius: 50%;
    background: var(--accent-dim);
    border: 1px solid rgba(200,169,110,0.35);
    display: flex; align-items: center; justify-content: center;
    flex-shrink: 0;
  }
  .header-icon svg { width: 17px; height: 17px; stroke: var(--accent); fill: none; stroke-width: 1.5; }

  .header-text h1 {
    font-family: 'DM Serif Display', serif;
    font-size: 1rem; font-weight: 400; letter-spacing: 0.01em;
  }
  .header-text p {
    font-size: 0.72rem; color: var(--muted);
    margin-top: 1px; letter-spacing: 0.04em; text-transform: uppercase;
  }

  .progress-wrap { margin-left: auto; text-align: right; }
  .progress-label { font-size: 0.68rem; color: var(--muted); text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 5px; }
  .progress-bar { width: 110px; height: 2px; background: var(--border); border-radius: 2px; overflow: hidden; margin-left: auto; }
  .progress-fill { height: 100%; background: var(--accent); border-radius: 2px; transition: width 0.7s ease; width: 0%; }
  .progress-count { font-size: 0.68rem; color: var(--muted); margin-top: 4px; }

  .messages {
    overflow-y: auto;
    padding: 28px 32px 12px;
    display: flex; flex-direction: column; gap: 18px;
    scroll-behavior: smooth;
  }
  .messages::-webkit-scrollbar { width: 3px; }
  .messages::-webkit-scrollbar-thumb { background: var(--border); border-radius: 2px; }

  .msg { display: flex; gap: 11px; animation: fadeUp 0.35s ease both; }
  .msg.user { flex-direction: row-reverse; }

  @keyframes fadeUp {
    from { opacity: 0; transform: translateY(8px); }
    to   { opacity: 1; transform: translateY(0); }
  }

  .avatar {
    width: 28px; height: 28px; border-radius: 50%; flex-shrink: 0;
    display: flex; align-items: center; justify-content: center;
    font-size: 0.6rem; font-weight: 500; letter-spacing: 0.05em; text-transform: uppercase;
    margin-top: 3px;
  }
  .avatar.ai   { background: var(--accent-dim); border: 1px solid rgba(200,169,110,0.3); color: var(--accent); }
  .avatar.user { background: var(--user-bg); border: 1px solid var(--border); color: var(--muted); }

  .bubble {
    max-width: 84%; padding: 13px 17px; border-radius: 16px;
    font-size: 0.875rem; line-height: 1.68;
  }
  .msg.ai   .bubble { background: var(--ai-bg); border: 1px solid var(--border); border-top-left-radius: 4px; }
  .msg.user .bubble { background: var(--user-bg); border: 1px solid var(--border); border-top-right-radius: 4px; }

  .section-badge {
    display: inline-block; font-size: 0.62rem; text-transform: uppercase;
    letter-spacing: 0.1em; color: var(--accent);
    border: 1px solid rgba(200,169,110,0.3); border-radius: 4px;
    padding: 2px 7px; margin-bottom: 9px;
  }

  .typing { display: flex; gap: 11px; animation: fadeUp 0.3s ease both; }
  .typing-dots {
    background: var(--ai-bg); border: 1px solid var(--border);
    border-top-left-radius: 4px; border-radius: 16px;
    padding: 13px 17px; display: flex; gap: 5px; align-items: center;
  }
  .dot { width: 5px; height: 5px; border-radius: 50%; background: var(--muted); animation: bounce 1.2s infinite; }
  .dot:nth-child(2) { animation-delay: 0.2s; }
  .dot:nth-child(3) { animation-delay: 0.4s; }
  @keyframes bounce {
    0%,60%,100% { transform: translateY(0); opacity: 0.4; }
    30% { transform: translateY(-5px); opacity: 1; }
  }

  .input-area { padding: 14px 32px 26px; border-top: 1px solid var(--border); }
  .input-row { display: flex; gap: 10px; align-items: flex-end; }

  textarea {
    flex: 1; background: var(--surface); border: 1px solid var(--border);
    border-radius: 12px; padding: 11px 15px; color: var(--text);
    font-family: 'DM Sans', sans-serif; font-size: 0.875rem; font-weight: 300;
    resize: none; outline: none; line-height: 1.5; min-height: 44px; max-height: 130px;
    transition: border-color 0.2s;
  }
  textarea:focus { border-color: rgba(200,169,110,0.4); }
  textarea::placeholder { color: var(--muted); }

  .send-btn {
    width: 42px; height: 42px; border-radius: 10px; background: var(--accent);
    border: none; cursor: pointer; display: flex; align-items: center; justify-content: center;
    transition: opacity 0.2s, transform 0.15s; flex-shrink: 0;
  }
  .send-btn:hover { opacity: 0.85; transform: scale(1.05); }
  .send-btn:disabled { opacity: 0.25; cursor: default; transform: none; }
  .send-btn svg { width: 17px; height: 17px; stroke: #0d0f14; fill: none; stroke-width: 2; }

  .hint { font-size: 0.7rem; color: var(--muted); text-align: center; margin-top: 8px; letter-spacing: 0.02em; }

  .end-card {
    background: var(--accent-dim); border: 1px solid rgba(200,169,110,0.22);
    border-radius: 16px; padding: 22px 24px; text-align: center;
  }
  .end-card h3 { font-family: 'DM Serif Display', serif; font-weight: 400; font-size: 1.1rem; color: var(--accent); margin-bottom: 6px; }
  .end-card p { font-size: 0.82rem; color: var(--muted); line-height: 1.6; }

  .copy-btn {
    margin-top: 14px; background: var(--accent); color: #0d0f14;
    border: none; border-radius: 8px; padding: 9px 22px;
    font-family: 'DM Sans', sans-serif; font-size: 0.8rem; font-weight: 500;
    cursor: pointer; letter-spacing: 0.03em; transition: opacity 0.2s;
  }
  .copy-btn:hover { opacity: 0.85; }
</style>
</head>
<body>
<div class="shell">

  <header>
    <div class="header-icon">
      <svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="9"/><path d="M12 8v4l3 3"/></svg>
    </div>
    <div class="header-text">
      <h1>Brand Discovery Interview</h1>
      <p>Pain Research Centre — Rebrand Brief</p>
    </div>
    <div class="progress-wrap">
      <div class="progress-label">Progress</div>
      <div class="progress-bar"><div class="progress-fill" id="progressFill"></div></div>
      <div class="progress-count" id="progressCount">0 / 17</div>
    </div>
  </header>

  <div class="messages" id="messages"></div>

  <div class="input-area">
    <div class="input-row">
      <textarea id="input" placeholder="Type your answer here…" rows="1" disabled></textarea>
      <button class="send-btn" id="sendBtn" disabled>
        <svg viewBox="0 0 24 24"><line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/></svg>
      </button>
    </div>
    <div class="hint" id="hint">Preparing your interview…</div>
  </div>

</div>
<script>
const QUESTIONS = [
  {
    section: "Identity & Soul",
    q: `Let's start at the core. If you had to describe the Centre in exactly 3 words — not what it does, but the feeling it gives off — what would those words be? For example: rigorous, human, pioneering. Take your time with this one, it shapes everything that follows.`
  },
  {
    section: "Identity & Soul",
    q: `Imagine the Centre as a person walking into a room. How do they carry themselves? How do they speak — are they the confident scientist at the whiteboard, the empathetic clinician who sits with patients, the quiet visionary who sees what others miss? Paint me a picture.`
  },
  {
    section: "Identity & Soul",
    q: `What would be lost if the Centre disappeared tomorrow? Not in terms of research output — but what gap would exist in the world, in people's lives?`
  },
  {
    section: "Logo & Iconography",
    q: `When you think of the Centre's work — pain, the brain, sensory experience, human connection — what images, shapes, or symbols naturally come to mind? Don't filter yourself, nothing is too abstract or too literal.`
  },
  {
    section: "Logo & Iconography",
    q: `Many neuroscience and pain research centres lean on predictable imagery — brain silhouettes, neural networks, DNA strands. Does any of that feel right for you, or does it feel too generic? Are there symbols from completely different fields — nature, architecture, mathematics — that resonate more with what you do?`
  },
  {
    section: "Logo & Iconography",
    q: `For the logo mark itself: do you want a standalone symbol that can exist without the name (think Nike or Apple), a wordmark where the name is the logo, or a combination of both? And should it feel geometric and precise, or more organic and fluid?`
  },
  {
    section: "Logo & Iconography",
    q: `What do you specifically dislike about the current logo — the font, the colour, the icon, the proportions, the overall feeling it gives? Be as direct as you like. This is exactly the feedback that makes a rebrand work.`
  },
  {
    section: "Colour",
    q: `Colour is one of the most powerful brand signals. In medical and neuroscience branding specifically, research shows it carries heavy psychological associations. When you imagine the Centre's visual world, what colours come to mind instinctively? And equally important: are there any colours that feel completely wrong — too clinical, too cold, too corporate?`
  },
  {
    section: "Colour",
    q: `I want to share some colour directions that branding research in healthcare and neuroscience suggests work well — what's your gut reaction? Deep navy or midnight blue signals trust, depth, intelligence. Warm slate or charcoal feels modern, serious, approachable. Muted teal or sage reads as calm, scientific, human. A warmer palette — ochre, sand, warm white — conveys warmth, hope, humanity. Any of those feel closer to the truth of the Centre, or further away?`
  },
  {
    section: "Colour",
    q: `Should the colour feel bold and confident — owning the space — or restrained and refined, letting the work speak for itself? And do you see a single strong primary colour, or a palette of two or three working together?`
  },
  {
    section: "Typography & Brand Voice",
    q: `Typography carries as much personality as colour. Research in medical branding shows serif fonts — the kind you see in academic journals — signal authority and trust. Clean sans-serifs signal modernity and accessibility. Many strong brands pair both. When you read a headline from the Centre, what should the type feel like: classic and authoritative, modern and clean, or a confident bridge between the two?`
  },
  {
    section: "Typography & Brand Voice",
    q: `Now let's talk about how the Centre speaks — its voice. If you had to describe the tone of every piece of writing on the new site, which direction feels closest: precise and academic (peer to peer), warm and accessible (speaking to patients and the public), or a confident bridge between both? Are there any words, phrases, or ways of talking about the Centre that you want to retire completely?`
  },
  {
    section: "Competitors & References",
    q: `Think about other pain research groups, neuroscience centres, or university labs — in Canada or internationally. Are there any whose brand, visual identity, or reputation you genuinely admire? And are there any you specifically want to be visually or tonally different from?`
  },
  {
    section: "Competitors & References",
    q: `Now think broader — outside academia entirely. Are there any organisations, companies, or brands in any field whose visual identity or communication style you find compelling? A tech company, a cultural institution, a publication, a clinic. What draws you to them?`
  },
  {
    section: "Competitors & References",
    q: `If you had to place the Centre on a spectrum — on one end, a prestigious traditional academic institution (Johns Hopkins, the Salk Institute), on the other, a modern purpose-driven organisation (the Chan Zuckerberg Initiative, a high-design research nonprofit) — where does the Centre sit today, and where do you want it to sit?`
  },
  {
    section: "Constraints & Final Thoughts",
    q: `Practically speaking — does the new identity need to visually connect to the University of Toronto in any way, such as referencing their colours or seal? Or does the Centre have the freedom to stand fully on its own?`
  },
  {
    section: "Constraints & Final Thoughts",
    q: `Last question, and it matters: is there anything about the current identity — a colour, a phrase, a feeling — that you actually want to keep? Sometimes there's something worth protecting in what already exists. And is there anything else about this rebrand, something we haven't touched on, that you want me to know before we begin?`
  }
];

const TOTAL = QUESTIONS.length;

const SYSTEM_PROMPT = `You are a senior brand strategist conducting a focused, intelligent brand discovery interview for a pain and neuroscience research centre at the University of Toronto that is undergoing a full rebrand. Your role is to listen carefully, respond with genuine warmth and intelligence, and guide the interviewee through the questions naturally.

Rules:
- Ask only ONE question per turn. Never stack questions.
- After each answer, give a specific, thoughtful acknowledgment (1–2 sentences) that shows you genuinely heard what they said. Reference something concrete from their answer. Never say "great answer" or "that's fascinating."
- Your tone: calm, intelligent, editorial, warm. Like a trusted creative director — not a chatbot.
- Never break character. Never mention being an AI.
- Do not give design opinions during the interview. Draw out their vision, not yours.
- When given a hidden instruction in brackets at the end of a user message, follow it silently.`;

let history    = [];
let allAnswers = [];
let currentQ   = 0;
let busy       = false;
let done       = false;

const messagesEl = document.getElementById('messages');
const inputEl    = document.getElementById('input');
const sendBtn    = document.getElementById('sendBtn');
const progFill   = document.getElementById('progressFill');
const progCount  = document.getElementById('progressCount');
const hint       = document.getElementById('hint');

function setProgress(n) {
  progFill.style.width = Math.round((n / TOTAL) * 100) + '%';
  progCount.textContent = `${n} / ${TOTAL}`;
}

function scrollBottom() {
  setTimeout(() => messagesEl.scrollTop = messagesEl.scrollHeight, 60);
}

function addBubble(role, text, section) {
  const wrap = document.createElement('div');
  wrap.className = `msg ${role}`;
  const av = document.createElement('div');
  av.className = `avatar ${role}`;
  av.textContent = role === 'ai' ? 'AI' : 'You';
  const bub = document.createElement('div');
  bub.className = 'bubble';
  if (role === 'ai' && section) {
    const badge = document.createElement('div');
    badge.className = 'section-badge';
    badge.textContent = section;
    bub.appendChild(badge);
    bub.appendChild(document.createElement('br'));
  }
  const span = document.createElement('span');
  span.innerHTML = text.replace(/\n/g, '<br>');
  bub.appendChild(span);
  wrap.appendChild(av);
  wrap.appendChild(bub);
  messagesEl.appendChild(wrap);
  scrollBottom();
}

function showTyping() {
  const d = document.createElement('div');
  d.className = 'typing'; d.id = 'typing-ind';
  d.innerHTML = `<div class="avatar ai">AI</div><div class="typing-dots"><div class="dot"></div><div class="dot"></div><div class="dot"></div></div>`;
  messagesEl.appendChild(d);
  scrollBottom();
}

function removeTyping() {
  const t = document.getElementById('typing-ind');
  if (t) t.remove();
}

function enableInput(yes) {
  inputEl.disabled = !yes;
  sendBtn.disabled = !yes;
  if (yes) { inputEl.focus(); hint.textContent = 'Press Enter to send · Shift+Enter for new line'; }
  else { hint.textContent = ''; }
}

function delay(ms) { return new Promise(r => setTimeout(r, ms)); }

async function callClaude(messages, maxTokens) {
  const res = await fetch("https://api.anthropic.com/v1/messages", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ model: "claude-sonnet-4-20250514", max_tokens: maxTokens, system: SYSTEM_PROMPT, messages })
  });
  if (!res.ok) throw new Error(`API ${res.status}`);
  const data = await res.json();
  return data.content.map(c => c.text || '').join('').trim();
}

async function startInterview() {
  showTyping();
  await delay(1300);
  removeTyping();
  const opening = `Hello — and thank you for making time for this. What we do together in the next little while will form the foundation of your rebrand, so there are no right or wrong answers here, only honest ones.\n\nWe'll move through 17 questions across six areas: your centre's identity and soul, the logo and iconography, colour, typography and voice, competitors and references, and finally some practical constraints.\n\nTake as much space as you need with each answer. Let's begin.\n\n${QUESTIONS[0].q}`;
  addBubble('ai', opening, QUESTIONS[0].section);
  history.push({ role: 'assistant', content: opening });
  currentQ = 1;
  setProgress(0);
  enableInput(true);
}

async function handleSend() {
  const text = inputEl.value.trim();
  if (!text || busy || done) return;
  busy = true;
  enableInput(false);

  const idx = currentQ - 1;
  allAnswers.push({ section: QUESTIONS[idx].section, q: QUESTIONS[idx].q, a: text });
  history.push({ role: 'user', content: text });
  addBubble('user', text);
  inputEl.value = '';
  inputEl.style.height = 'auto';

  showTyping();
  await delay(700 + Math.random() * 500);

  try {
    if (currentQ < QUESTIONS.length) {
      const nextQ = QUESTIONS[currentQ];
      const sectionChanged = nextQ.section !== QUESTIONS[currentQ - 1].section;
      const sectionNote = sectionChanged
        ? ` After acknowledging, write one brief orienting sentence transitioning into the "${nextQ.section}" section of the interview.`
        : '';

      const messages = [
        ...history.slice(0, -1),
        { role: 'user', content: text + `\n\n[Hidden instruction: Acknowledge this answer warmly and specifically in 1–2 sentences.${sectionNote} Then ask this question exactly: "${nextQ.q}"]` }
      ];

      const reply = await callClaude(messages, 480);
      removeTyping();
      addBubble('ai', reply, sectionChanged ? nextQ.section : null);
      history.push({ role: 'assistant', content: reply });
      currentQ++;
      setProgress(currentQ - 1);
      enableInput(true);
      busy = false;

    } else {
      // Last answer — closing message
      const closingMsgs = [
        ...history.slice(0, -1),
        { role: 'user', content: text + `\n\n[Hidden instruction: Acknowledge their final answer specifically. Then write a warm 2–3 sentence closing letting them know the interview is complete and their brand brief is being generated.]` }
      ];
      const closing = await callClaude(closingMsgs, 280);
      removeTyping();
      addBubble('ai', closing);
      history.push({ role: 'assistant', content: closing });

      // Generate brand brief
      showTyping();
      await delay(900);
      const summary = await callClaude([{ role: 'user', content: buildSummaryPrompt() }], 1400);
      removeTyping();

      window._summary = summary;
      done = true;
      setProgress(TOTAL);

      // Auto-send email via EmailJS
      let emailStatus = 'sending';
      emailjs.send('service_l5n4d0j', 'template_r32nl1g', { brief: summary })
        .then(() => { emailStatus = 'sent'; updateCard(); })
        .catch(() => { emailStatus = 'failed'; updateCard(); });

      const card = document.createElement('div');
      card.className = 'end-card';
      card.id = 'endCard';
      card.innerHTML = `
        <h3>Brand Brief Ready</h3>
        <p id="emailNote">Sending brief by email...</p>
        <p style="font-size:0.78rem;color:var(--muted);margin-top:4px">You can also copy it manually below.</p>
        <button class="copy-btn" id="copyBtn">Copy Brand Brief</button>
      `;
      messagesEl.appendChild(card);
      scrollBottom();
      hint.textContent = 'Interview complete';

      function updateCard() {
        const note = document.getElementById('emailNote');
        if (!note) return;
        if (emailStatus === 'sent') {
          note.style.color = '#c8a96e';
          note.textContent = 'Brief sent to you by email.';
        } else {
          note.style.color = '#e07070';
          note.textContent = 'Email failed — please use the copy button below.';
        }
      }

      document.getElementById('copyBtn').addEventListener('click', function () {
        navigator.clipboard.writeText(window._summary).then(() => {
          this.textContent = 'Copied!';
          setTimeout(() => this.textContent = 'Copy Brand Brief', 2200);
        });
      });
    }
  } catch (err) {
    removeTyping();
    addBubble('ai', 'Something went wrong — please check your connection and try sending your answer again.');
    enableInput(true);
    busy = false;
  }
}

function buildSummaryPrompt() {
  let sections = {};
  for (const item of allAnswers) {
    if (!sections[item.section]) sections[item.section] = [];
    sections[item.section].push(item);
  }
  let raw = '';
  for (const [sec, items] of Object.entries(sections)) {
    raw += `\n### ${sec}\n`;
    for (const i of items) raw += `Q: ${i.q}\nA: ${i.a}\n\n`;
  }
  return `You are a senior brand strategist. Based on the following brand discovery interview for a pain and neuroscience research centre at the University of Toronto, write a comprehensive, professional Brand Discovery Brief that a graphic designer can act on immediately.

Structure:
1. Brand Essence — 1 short paragraph synthesising the soul of the organisation
2. Identity & Personality — key traits, the "person" they described, what would be lost
3. Logo & Iconography Direction — symbols mentioned, style (geometric vs organic, wordmark vs icon), what to avoid, what the current logo fails at
4. Colour Direction — specific directions from their answers + note the research-backed rationale: in healthcare/neuroscience branding, navy/deep blue builds trust and authority; teal/sage signals scientific calm with humanity; warm neutrals (ochre, sand) convey hope and approachability; avoid sterile white-only palettes which read as cold and impersonal
5. Typography Direction — serif vs sans recommendation based on their answer + note the rationale: serifs (Freight, Garamond, Canela) convey academic authority and trust in medical contexts; geometric sans (Neue Haas, Aktiv Grotesk) signal modern accessibility; a serif/sans pairing is often ideal for research institutions
6. Brand Voice — tone, how they speak, words or phrases to retire
7. Competitive Landscape — who they admire, who they want to differ from, where on the traditional-to-modern spectrum they sit
8. Constraints & Non-negotiables — UofT connection requirements, anything to keep from current identity
9. Designer Action Items — 5–7 specific, actionable next steps

Be specific. Reference their actual answers directly. Write in clear professional prose. This is a real working document.

INTERVIEW TRANSCRIPT:
${raw}`;
}

inputEl.addEventListener('input', () => {
  inputEl.style.height = 'auto';
  inputEl.style.height = Math.min(inputEl.scrollHeight, 130) + 'px';
});
inputEl.addEventListener('keydown', e => {
  if (e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); handleSend(); }
});
sendBtn.addEventListener('click', handleSend);
setTimeout(startInterview, 500);
</script>
</body>
</html>
